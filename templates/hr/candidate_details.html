{% extends "base.html" %}

{% block title %}Candidate Profile - HR Dashboard{% endblock %}

{% block content %}
<div class="candidate-container">
    <div class="container-fluid">
        <!-- Header -->
        <div class="candidate-header mb-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{{ url_for('hr.dashboard') }}">Dashboard</a></li>
                            <li class="breadcrumb-item"><a href="{{ url_for('hr.view_applications') }}">Applications</a></li>
                            <li class="breadcrumb-item active">Candidate Profile</li>
                        </ol>
                    </nav>
                    <h1 class="candidate-title">{{ candidate.name }}</h1>
                    <p class="candidate-subtitle">Applied for {{ application.job.title }}</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="candidate-actions">
                        <button class="btn btn-success me-2" onclick="updateStatus('shortlisted')">
                            <i class="fas fa-star me-2"></i>Shortlist
                        </button>
                        <button class="btn btn-danger" onclick="updateStatus('rejected')">
                            <i class="fas fa-times me-2"></i>Reject
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- AI Analysis -->
                <div class="analysis-card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-robot me-2"></i>AI Analysis
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <div class="overall-score">
                                    <div class="score-circle score-{{ application.ai_score | score_class }} large">
                                        {{ application.ai_score | round | int }}%
                                    </div>
                                    <h6>Overall Match</h6>
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="score-breakdown">
                                    <div class="score-item">
                                        <div class="score-label">Skills Match</div>
                                        <div class="progress">
                                            <div class="progress-bar bg-success" style="width: 85%">85%</div>
                                        </div>
                                    </div>
                                    <div class="score-item">
                                        <div class="score-label">Experience Level</div>
                                        <div class="progress">
                                            <div class="progress-bar bg-warning" style="width: 75%">75%</div>
                                        </div>
                                    </div>
                                    <div class="score-item">
                                        <div class="score-label">Education Match</div>
                                        <div class="progress">
                                            <div class="progress-bar bg-info" style="width: 90%">90%</div>
                                        </div>
                                    </div>
                                    <div class="score-item">
                                        <div class="score-label">Location Preference</div>
                                        <div class="progress">
                                            <div class="progress-bar bg-primary" style="width: 100%">100%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="ai-recommendation mt-4">
                            <div class="alert alert-success">
                                <h6><i class="fas fa-lightbulb me-2"></i>AI Recommendation</h6>
                                <p class="mb-0">
                                    <strong>Highly Recommended for Interview.</strong> 
                                    This candidate shows excellent alignment with job requirements, particularly in technical skills and experience level.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Resume Details -->
                <div class="resume-card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-file-alt me-2"></i>Resume Details
                        </h5>
                    </div>
                    <div class="card-body">
                        {% if candidate.parsed_data %}
                        <div class="resume-section">
                            <h6>Professional Summary</h6>
                            <p>{{ candidate.get_parsed_data().get('summary', 'No summary available') }}</p>
                        </div>

                        <div class="resume-section">
                            <h6>Skills</h6>
                            <div class="skills-list">
                                {% for skill in candidate.get_skills() %}
                                <span class="skill-tag">{{ skill }}</span>
                                {% endfor %}
                            </div>
                        </div>

                        <div class="resume-section">
                            <h6>Experience</h6>
                            <p><strong>{{ candidate.experience_years or 0 }} years</strong> of professional experience</p>
                        </div>

                        <div class="resume-section">
                            <h6>Education</h6>
                            <p>{{ candidate.education or 'Not specified' }}</p>
                        </div>
                        {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Resume not yet parsed. Please upload a resume for detailed analysis.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Application Timeline -->
                <div class="timeline-card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-clock me-2"></i>Application Timeline
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-marker bg-primary"></div>
                                <div class="timeline-content">
                                    <h6>Application Submitted</h6>
                                    <p class="text-muted">{{ application.applied_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
                                </div>
                            </div>
                            {% if application.status != 'pending' %}
                            <div class="timeline-item">
                                <div class="timeline-marker bg-{{ application.status | status_class }}"></div>
                                <div class="timeline-content">
                                    <h6>Status Updated to {{ application.status.title() }}</h6>
                                    <p class="text-muted">{{ application.updated_at.strftime('%B %d, %Y at %I:%M %p') if application.updated_at else 'Recently' }}</p>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Contact Information -->
                <div class="contact-card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-address-card me-2"></i>Contact Information
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="contact-item">
                            <i class="fas fa-envelope text-primary me-3"></i>
                            <div>
                                <strong>Email</strong>
                                <p class="mb-0">{{ candidate.user.email }}</p>
                            </div>
                        </div>
                        {% if candidate.phone %}
                        <div class="contact-item">
                            <i class="fas fa-phone text-success me-3"></i>
                            <div>
                                <strong>Phone</strong>
                                <p class="mb-0">{{ candidate.phone }}</p>
                            </div>
                        </div>
                        {% endif %}
                        {% if candidate.location %}
                        <div class="contact-item">
                            <i class="fas fa-map-marker-alt text-danger me-3"></i>
                            <div>
                                <strong>Location</strong>
                                <p class="mb-0">{{ candidate.location }}</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Job Match Details -->
                <div class="match-card mb-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-bullseye me-2"></i>Job Match Analysis
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="match-item">
                            <h6>Matching Skills</h6>
                            <div class="skills-match">
                                {% set job_skills = application.job.get_required_skills() %}
                                {% set candidate_skills = candidate.get_skills() %}
                                {% for skill in job_skills %}
                                    {% if skill in candidate_skills %}
                                    <span class="skill-tag match">{{ skill }}</span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="match-item">
                            <h6>Missing Skills</h6>
                            <div class="skills-missing">
                                {% for skill in job_skills %}
                                    {% if skill not in candidate_skills %}
                                    <span class="skill-tag missing">{{ skill }}</span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="actions-card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-bolt me-2"></i>Quick Actions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2">
                            {% if candidate.resume_file %}
                            <button class="btn btn-outline-primary" onclick="downloadResume()">
                                <i class="fas fa-download me-2"></i>Download Resume
                            </button>
                            {% endif %}
                            <button class="btn btn-outline-info" onclick="sendEmail()">
                                <i class="fas fa-envelope me-2"></i>Send Email
                            </button>
                            <button class="btn btn-outline-success" onclick="scheduleInterview()">
                                <i class="fas fa-calendar me-2"></i>Schedule Interview
                            </button>
                            <button class="btn btn-outline-secondary" onclick="addNotes()">
                                <i class="fas fa-sticky-note me-2"></i>Add Notes
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.candidate-container {
    padding: 2rem 0;
    background: #f8fafc;
    min-height: 100vh;
}

.candidate-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 0.5rem;
}

.candidate-subtitle {
    color: #6b7280;
    font-size: 1.1rem;
}

.analysis-card, .resume-card, .timeline-card, .contact-card, .match-card, .actions-card {
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #e5e7eb;
}

.card-header {
    background: #f8fafc;
    border-bottom: 1px solid #e5e7eb;
    padding: 1.25rem 1.5rem;
}

.card-body {
    padding: 1.5rem;
}

.score-circle.large {
    width: 80px;
    height: 80px;
    font-size: 1.25rem;
}

.score-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: white;
    margin: 0 auto 0.5rem;
}

.score-high { background: #10b981; }
.score-medium { background: #f59e0b; }
.score-low { background: #ef4444; }

.score-breakdown .score-item {
    margin-bottom: 1rem;
}

.score-label {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #374151;
}

.progress {
    height: 8px;
    border-radius: 4px;
}

.resume-section {
    margin-bottom: 1.5rem;
}

.resume-section h6 {
    color: #374151;
    font-weight: 600;
    margin-bottom: 0.75rem;
}

.skills-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.skill-tag {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.875rem;
    font-weight: 500;
}

.skill-tag.match {
    background: #dcfce7;
    color: #166534;
}

.skill-tag.missing {
    background: #fef2f2;
    color: #dc2626;
}

.skill-tag:not(.match):not(.missing) {
    background: #f3f4f6;
    color: #374151;
}

.timeline {
    position: relative;
    padding-left: 2rem;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 0.75rem;
    top: 0;
    bottom: 0;
    width: 2px;
    background: #e5e7eb;
}

.timeline-item {
    position: relative;
    margin-bottom: 2rem;
}

.timeline-marker {
    position: absolute;
    left: -2rem;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 0 0 2px #e5e7eb;
}

.timeline-content h6 {
    color: #374151;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.contact-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 1.5rem;
}

.contact-item:last-child {
    margin-bottom: 0;
}

.contact-item i {
    margin-top: 0.25rem;
}

.match-item {
    margin-bottom: 1.5rem;
}

.match-item:last-child {
    margin-bottom: 0;
}

.match-item h6 {
    color: #374151;
    font-weight: 600;
    margin-bottom: 0.75rem;
}

@media (max-width: 768px) {
    .candidate-container {
        padding: 1rem 0;
    }
    
    .candidate-title {
        font-size: 2rem;
    }
    
    .candidate-actions {
        margin-top: 1rem;
    }
    
    .candidate-actions .btn {
        display: block;
        width: 100%;
        margin-bottom: 0.5rem;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
function updateStatus(newStatus) {
    const applicationId = {{ application.id }};
    
    if (confirm(`Are you sure you want to ${newStatus} this candidate?`)) {
        fetch(`/hr/application/${applicationId}/status`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status: newStatus })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error updating status');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error updating status');
        });
    }
}

function downloadResume() {
    const jobseekerId = {{ candidate.id }};
    window.open(`/hr/download-resume/${jobseekerId}`, '_blank');
}

function sendEmail() {
    const email = '{{ candidate.user.email }}';
    window.location.href = `mailto:${email}`;
}

function scheduleInterview() {
    alert('Interview scheduling feature - to be implemented');
}

function addNotes() {
    alert('Notes feature - to be implemented');
}
</script>
{% endblock %}
